<!DOCTYPE html>
<html lang="en">
  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Twitter -->
    <meta name="twitter:site" content="@themepixels">
    <meta name="twitter:creator" content="@themepixels">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DashForge">
    <meta name="twitter:description" content="Responsive Bootstrap 4 Dashboard Template">
    <meta name="twitter:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">

    <!-- Facebook -->
    <meta property="og:url" content="http://themepixels.me/dashforge">
    <meta property="og:title" content="DashForge">
    <meta property="og:description" content="Responsive Bootstrap 4 Dashboard Template">

    <meta property="og:image" content="http://themepixels.me/dashforge/img/dashforge-social.png">
    <meta property="og:image:secure_url" content="http://themepixels.me/dashforge/img/dashforge-social.png">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="600">

    <!-- Meta -->
    <meta name="description" content="Responsive Bootstrap 4 Dashboard Template">
    <meta name="author" content="ThemePixels">

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicon.png">

    <title>D8 - 主控台</title>

    <!-- vendor css -->
    <link href="lib/@fortawesome/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="lib/jqvmap/jqvmap.min.css" rel="stylesheet">

    <!-- DashForge CSS -->
    <link rel="stylesheet" href="assets/css/dashforge.css">
    <link rel="stylesheet" href="assets/css/dashforge.dashboard.css">
  </head>
  <body class="page-profile">
    <header class="navbar navbar-header navbar-header-fixed">
      <a href="" id="mainMenuOpen" class="burger-menu"><i data-feather="menu"></i></a>
      <div class="navbar-brand">
        <a href="index.html" class="df-logo">D<span>8</span></a>
      </div><!-- navbar-brand -->
      <div id="navbarMenu" class="navbar-menu-wrapper">
        <div class="navbar-menu-header">
          <a href="index.html" class="df-logo">D<span>8</span></a>
          <a id="mainMenuClose" href=""><i data-feather="x"></i></a>
        </div><!-- navbar-menu-header -->
        <ul class="nav navbar-menu">
          <li class="nav-label pd-l-20 pd-lg-l-25 d-lg-none">Main Navigation</li>
          <li class="nav-item with-sub active">
            <a href="" class="nav-link"><i data-feather="pie-chart"></i> Dashboard</a>
            <ul class="navbar-menu-sub">
              <li class="nav-sub-item"><a href="dashboard-one.html" class="nav-sub-link"><i data-feather="bar-chart-2"></i>Sales Monitoring</a></li>
              <li class="nav-sub-item"><a href="dashboard-two.html" class="nav-sub-link"><i data-feather="bar-chart-2"></i>Website Analytics</a></li>
              <li class="nav-sub-item"><a href="dashboard-three.html" class="nav-sub-link"><i data-feather="bar-chart-2"></i>Cryptocurrency</a></li>
              <li class="nav-sub-item"><a href="dashboard-four.html" class="nav-sub-link"><i data-feather="bar-chart-2"></i>Helpdesk Management</a></li>
            </ul>
          </li>
          <li class="nav-item with-sub">
            <a href="" class="nav-link"><i data-feather="package"></i> Apps</a>
            <ul class="navbar-menu-sub">
              <li class="nav-sub-item"><a href="app-calendar.html" class="nav-sub-link"><i data-feather="calendar"></i>Calendar</a></li>
              <li class="nav-sub-item"><a href="app-chat.html" class="nav-sub-link"><i data-feather="message-square"></i>Chat</a></li>
              <li class="nav-sub-item"><a href="app-contacts.html" class="nav-sub-link"><i data-feather="users"></i>Contacts</a></li>
              <li class="nav-sub-item"><a href="app-file-manager.html" class="nav-sub-link"><i data-feather="file-text"></i>File Manager</a></li>
              <li class="nav-sub-item"><a href="app-mail.html" class="nav-sub-link"><i data-feather="mail"></i>Mail</a></li>
            </ul>
          </li>
          <li class="nav-item with-sub">
            <a href="" class="nav-link"><i data-feather="layers"></i> Pages</a>
            <div class="navbar-menu-sub">
              <div class="d-lg-flex">
                <ul>
                  <li class="nav-label">Authentication</li>
                  <li class="nav-sub-item"><a href="page-signin.html" class="nav-sub-link"><i data-feather="log-in"></i> Sign In</a></li>
                  <li class="nav-sub-item"><a href="page-signup.html" class="nav-sub-link"><i data-feather="user-plus"></i> Sign Up</a></li>
                  <li class="nav-sub-item"><a href="page-verify.html" class="nav-sub-link"><i data-feather="user-check"></i> Verify Account</a></li>
                  <li class="nav-sub-item"><a href="page-forgot.html" class="nav-sub-link"><i data-feather="shield-off"></i> Forgot Password</a></li>
                  <li class="nav-label mg-t-20">User Pages</li>
                  <li class="nav-sub-item"><a href="page-profile-view.html" class="nav-sub-link"><i data-feather="user"></i> View Profile</a></li>
                  <li class="nav-sub-item"><a href="page-connections.html" class="nav-sub-link"><i data-feather="users"></i> Connections</a></li>
                  <li class="nav-sub-item"><a href="page-groups.html" class="nav-sub-link"><i data-feather="users"></i> Groups</a></li>
                  <li class="nav-sub-item"><a href="page-events.html" class="nav-sub-link"><i data-feather="calendar"></i> Events</a></li>
                </ul>
                <ul>
                  <li class="nav-label">Error Pages</li>
                  <li class="nav-sub-item"><a href="page-404.html" class="nav-sub-link"><i data-feather="file"></i> 404 Page Not Found</a></li>
                  <li class="nav-sub-item"><a href="page-500.html" class="nav-sub-link"><i data-feather="file"></i> 500 Internal Server</a></li>
                  <li class="nav-sub-item"><a href="page-503.html" class="nav-sub-link"><i data-feather="file"></i> 503 Service Unavailable</a></li>
                  <li class="nav-sub-item"><a href="page-505.html" class="nav-sub-link"><i data-feather="file"></i> 505 Forbidden</a></li>
                  <li class="nav-label mg-t-20">Other Pages</li>
                  <li class="nav-sub-item"><a href="page-timeline.html" class="nav-sub-link"><i data-feather="file-text"></i> Timeline</a></li>
                  <li class="nav-sub-item"><a href="page-pricing.html" class="nav-sub-link"><i data-feather="file-text"></i> Pricing</a></li>
                  <li class="nav-sub-item"><a href="page-help-center.html" class="nav-sub-link"><i data-feather="file-text"></i> Help Center</a></li>
                  <li class="nav-sub-item"><a href="page-invoice.html" class="nav-sub-link"><i data-feather="file-text"></i> Invoice</a></li>
                </ul>
              </div>
            </div><!-- nav-sub -->
          </li>
          <li class="nav-item"><a href="components/" class="nav-link"><i data-feather="box"></i> Components</a></li>
          <li class="nav-item"><a href="collections/" class="nav-link"><i data-feather="archive"></i> Collections</a></li>
        </ul>
      </div><!-- navbar-menu-wrapper -->
      <div class="navbar-right">
        <a id="navbarSearch" href="" class="search-link"><i data-feather="search"></i></a>
        <div class="dropdown dropdown-message">
          <a href="" class="dropdown-link new-indicator" data-toggle="dropdown">
            <i data-feather="message-square"></i>
            <span>5</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <div class="dropdown-header">New Messages</div>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/350" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <strong>Socrates Itumay</strong>
                  <p>nam libero tempore cum so...</p>
                  <span>Mar 15 12:32pm</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/500" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <strong>Joyce Chua</strong>
                  <p>on the other hand we denounce...</p>
                  <span>Mar 13 04:16am</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/600" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <strong>Althea Cabardo</strong>
                  <p>is there anyone who loves...</p>
                  <span>Mar 13 02:56am</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/500" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <strong>Adrian Monino</strong>
                  <p>duis aute irure dolor in repre...</p>
                  <span>Mar 12 10:40pm</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <div class="dropdown-footer"><a href="">View all Messages</a></div>
          </div><!-- dropdown-menu -->
        </div><!-- dropdown -->
        <div class="dropdown dropdown-notification">
          <a href="" class="dropdown-link new-indicator" data-toggle="dropdown">
            <i data-feather="bell"></i>
            <span>2</span>
          </a>
          <div class="dropdown-menu dropdown-menu-right">
            <div class="dropdown-header">Notifications</div>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/350" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <p>Congratulate <strong>Socrates Itumay</strong> for work anniversaries</p>
                  <span>Mar 15 12:32pm</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/500" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <p><strong>Joyce Chua</strong> just created a new blog post</p>
                  <span>Mar 13 04:16am</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/600" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <p><strong>Althea Cabardo</strong> just created a new blog post</p>
                  <span>Mar 13 02:56am</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <a href="" class="dropdown-item">
              <div class="media">
                <div class="avatar avatar-sm avatar-online"><img src="https://via.placeholder.com/500" class="rounded-circle" alt=""></div>
                <div class="media-body mg-l-15">
                  <p><strong>Adrian Monino</strong> added new comment on your photo</p>
                  <span>Mar 12 10:40pm</span>
                </div><!-- media-body -->
              </div><!-- media -->
            </a>
            <div class="dropdown-footer"><a href="">View all Notifications</a></div>
          </div><!-- dropdown-menu -->
        </div><!-- dropdown -->
        <div class="dropdown dropdown-profile">
          <a href="" class="dropdown-link" data-toggle="dropdown" data-display="static">
            <div class="avatar avatar-sm"><img src="/assets/img/wallet-connect.png" class="rounded-circle" alt=""></div>
          </a><!-- dropdown-link -->
          <div class="dropdown-menu dropdown-menu-right tx-13">
            <div class="avatar avatar-lg mg-b-15"><img src="/assets/img/wallet-connect.png" class="rounded-circle" alt=""></div>
            <h6 class="tx-semibold mg-b-5">使用 WalletConnect</h6>
            <p class="mg-b-25 tx-12 tx-color-03">請先連結錢包查看服務器</p>
            <a href="javascript:onConnect()" class="dropdown-item"><i id="icon-connect-btn" data-feather="link-2"></i> <i18n id="connectBtn">連線錢包</i18n></a>
          </div><!-- dropdown-menu -->
        </div><!-- dropdown -->
      </div><!-- navbar-right -->
      <div class="navbar-search">
        <div class="navbar-search-header">
          <input type="search" class="form-control" placeholder="Type and hit enter to search...">
          <button class="btn"><i data-feather="search"></i></button>
          <a id="navbarSearchClose" href="" class="link-03 mg-l-5 mg-lg-l-10"><i data-feather="x"></i></a>
        </div><!-- navbar-search-header -->
        <div class="navbar-search-body">
          <label class="tx-10 tx-medium tx-uppercase tx-spacing-1 tx-color-03 mg-b-10 d-flex align-items-center">Recent Searches</label>
          <ul class="list-unstyled">
            <li><a href="dashboard-one.html">modern dashboard</a></li>
            <li><a href="app-calendar.html">calendar app</a></li>
            <li><a href="collections/modal.html">modal examples</a></li>
            <li><a href="components/el-avatar.html">avatar</a></li>
          </ul>

          <hr class="mg-y-30 bd-0">

          <label class="tx-10 tx-medium tx-uppercase tx-spacing-1 tx-color-03 mg-b-10 d-flex align-items-center">Search Suggestions</label>

          <ul class="list-unstyled">
            <li><a href="dashboard-one.html">cryptocurrency</a></li>
            <li><a href="app-calendar.html">button groups</a></li>
            <li><a href="collections/modal.html">form elements</a></li>
            <li><a href="components/el-avatar.html">contact app</a></li>
          </ul>
        </div><!-- navbar-search-body -->
      </div><!-- navbar-search -->
    </header><!-- navbar -->

    <div class="content content-fixed">
      <div class="container pd-x-0 pd-lg-x-10 pd-xl-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-30">
          <div>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                <li class="breadcrumb-item"><a href="#">主控台</a></li>
                <li class="breadcrumb-item active" aria-current="page">服務器列表</li>
              </ol>
            </nav>
            <h4 class="mg-b-0 tx-spacing--1">歡迎使用 D8 匿蹤服務器</h4>
          </div>
          
        </div>

        <div class="row row-xs">
          
          <div class="col-12 mg-t-10">
            <div class="card">
              <div class="card-header">
                <h6 class="mg-b-0">您的匿蹤服務器列表</h6>
              </div><!-- card-header -->
              <div class="card-body pd-0">
                <div id="serverList" class="row no-gutters">
                  請先連結錢包以檢視服務器列表
                  <script>icoX('Han Solo');</script>
                </div><!-- row -->
              </div><!-- card-body -->
            </div><!-- card -->
          </div><!-- col -->
          
        </div><!-- row -->
      </div><!-- container -->
    </div><!-- content -->



    <footer class="footer">
      <div>
        <span>&copy; 2022 D8 v1.0.0. </span>
        <span>Powered by <a href="http://d8.run">D8.RUN</a></span>
      </div>
      <div>
        <nav class="nav">
          <a href="https://d8.run" class="nav-link">授權宣告</a>
        </nav>
      </div>
    </footer>

    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="lib/feather-icons/feather.min.js"></script>
    <script src="lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="lib/jquery.flot/jquery.flot.js"></script>
    <script src="lib/jquery.flot/jquery.flot.stack.js"></script>
    <script src="lib/jquery.flot/jquery.flot.resize.js"></script>
    <script src="lib/chart.js/Chart.bundle.min.js"></script>
    
    <script src="assets/js/dashforge.js"></script>
    <script src="assets/js/dashforge.sampledata.js"></script>

    <!-- append theme customizer -->
    <script src="lib/js-cookie/js.cookie.js"></script>
    <script src="assets/js/dashforge.settings.js"></script>
    <script src="assets/js/base64.js"></script>
    <script src="assets/js/iconx.js"></script>

    <!-- append Web3 -->
    <script type="text/javascript" src="assets/js/web3.min.js"></script>
    <script type="text/javascript" src="assets/js/web3modal.js"></script>
    <script type="text/javascript" src="assets/js/evm-chains.js"></script>
    <script type="text/javascript" src="assets/js/web3-provider.js"></script>
    <script>
      const Web3Modal = window.Web3Modal.default;
      const WalletConnectProvider = window.WalletConnectProvider.default;
      const evmChains = window.evmChains;
      
      let web3;
      let provider;
      let accounts = [];
      let selectedAccount;

      function init() {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const serverName = Base64.decode(decodeURI(urlParams.get('serverName')));

        $("#serverName").text(serverName);

        if(location.protocol !== 'https:') {
          
          document.querySelector("#connectBtn").setAttribute("disabled", "disabled")
          return;
        }

        const providerOptions = {
          walletconnect: {
            package: WalletConnectProvider,
            options: {
              infuraId: "d8b01dcd88504c5aaa75a51e35e7dde5",
            }
          }
        };

        web3Modal = new Web3Modal({
          cacheProvider: false, // optional
          providerOptions, // required
          disableInjectedProvider: false, // optional. For MetaMask / Brave / Opera.
        });

        onConnect();
      }

      async function refreshAccountData() {
        await fetchAccountData(provider);
      }

      async function fetchAccountData() {
        web3 = new Web3(provider);
        const chainId = await web3.eth.getChainId();
        const chainData = evmChains.getChain(chainId);
        accounts = await web3.eth.getAccounts();
        selectedAccount = accounts[0];

        const rowResolvers = accounts.map(async (address) => {
          const balance = await web3.eth.getBalance(address);
          const ethBalance = web3.utils.fromWei(balance, "ether");
          const humanFriendlyBalance = parseFloat(ethBalance).toFixed(4);
        });
        await Promise.all(rowResolvers);
        
      }

      async function callAPI(method, params) {
        let b64 = Base64.encode(JSON.stringify({
          "method": method,
          "params": params
        }));
        const response = await fetch("https://api.d8.run/challenge" , {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: b64,
        });
        let data = await response.json();
        console.log(data);
      }

      async function onConnect() {
        try {
          provider = await web3Modal.connect();
        } catch(e) {
          return;
        }

        $("#connectBtn").text("斷開連線");
        $("#icon-connect-btn").attr("data-feather", "x");
        feather.replace();

        provider.on("accountsChanged", (accounts) => {
          fetchAccountData();
        });

        provider.on("chainChanged", (chainId) => {
          fetchAccountData();
        });

        provider.on("networkChanged", (networkId) => {
          fetchAccountData();
        });

        await refreshAccountData();
      }

      async function onDisconnect() {
        if(provider.close) {
          await provider.close();
          await web3Modal.clearCachedProvider();
          provider = null;
        }
        selectedAccount = null;
        $("#connectBtn").text("連線錢包");
        $("#icon-connect-btn").attr("data-feather", "link-2");
        feather.replace();
      }

      window.addEventListener('load', async () => {
        init();
      });

      async function sign(message) {
        return await web3.currentProvider.request({
          method: "personal_sign",
          params: [
            selectedAccount,
            message
          ]
        });
      }

    </script>
    <script>
      /*
      addServer('小陳作業機', 1, '61.214.254.114', 10406346, "jp", 33);
      addServer('A組作業機', 2, '127.0.0.1', 346346, "uk", 25);
      addServer('資金盤伺服器', 3, '192.168.0.1', 932958, "in", 100);
      */

      function addServer(name, type, ip, remain, country, cpu) {
        let icon = 'fa-solid fa-laptop';
        let desc = '匿蹤作業機';
        if(type == 1) {
          icon = 'fa-solid fa-laptop';
          desc = '匿蹤作業機';
        } else if(type == 2) {
          icon = 'fa-regular fa-laptop-code';
          desc = '匿蹤服務器';
        } else if(type == 3) {
          icon = 'fa-duotone fa-server';
          desc = '高階匿蹤服務器';
        }
        let template = '<div class="col col-sm-6 col-lg bd-t bd-lg-t-0 bd-sm-l">';
          template += '<div class="crypto">';
            template += '<div class="media mg-b-10">';
              template += '<img style="width: 40px;height: 20px" src="assets/img/' + country + '.png" />';
              template += '<div class="media-body pd-l-8">';
                template += '<h6 class="tx-11 tx-spacing-1 tx-uppercase tx-semibold mg-b-5"><a href="details.html?ip=' + ip + '&serverName=' + encodeURI(Base64.encode(name)) + '">' + name + '</a><span class="tx-color-03 tx-normal">(' + desc + ')</span></h6>';
                template += '<div class="d-flex align-items-baseline tx-rubik">';
                  template += '<h5 class="tx-20 mg-b-0">' + ip + '</h5>';
                  template += '<p class="mg-b-0 tx-11 tx-info mg-l-3"><i class="fa ' + icon + '"></i> ' + cpu + '%</p>';
                template += '</div>';
              template += '</div>';
            template += '</div>';
            template += '<div class="chart-twelve">';
            template += '</div>';
            template += '<div class="pos-absolute b-5 l-20 tx-medium">';
              template += '<label class="tx-9 tx-uppercase tx-sans tx-color-03">';
          
          let days = Math.floor(remain / 86400);
          remain = remain % 86400;
          let hours = Math.floor(remain / 3600);
          remain = remain % 3600;
          let minutes = Math.floor(remain / 60);
          remain = remain % 60;
          let seconds = remain;

          let remainTimeStr = "";
          if(days > 0) {
            remainTimeStr += days + "天";
          }
          if(hours > 0) {
            remainTimeStr += hours + "時";
          }
          if(minutes > 0) {
            remainTimeStr += minutes + "分";
          }
          if(seconds > 0) {
            remainTimeStr += seconds + "秒";
          }

                template += '<a href="" class="link-01 tx-semibold">' + remainTimeStr + '</a> 剩餘使用時間'
              template += '</label>';
            template += '</div>';
          template += '</div>';
        template += '</div>';
        $("#serverList").append(template);
      }
    </script>
  </body>
</html>
